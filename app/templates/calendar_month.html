{% extends "base.html" %}
{% block body %}
<div class="title">달력(월간)</div>
<a class="toplink" href="/">← 홈</a>

<div class="card">
  <div class="card-bd" style="overflow:auto">
    <div style="display:flex;align-items:center;justify-content:center;gap:18px;margin-bottom:10px;">
      <a href="/page/calendar/month?year={{ prev_y }}&month={{ prev_m }}">◀</a>
      <div style="font-weight:800;">{{ year }}년 {{ month }}월</div>
      <a href="/page/calendar/month?year={{ next_y }}&month={{ next_m }}">▶</a>
    </div>

    <table>
      <thead><tr><th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th></tr></thead>
      <tbody>
        {% for week in grid %}
          <tr>
            {% for d in week %}
              {% set ds = d.strftime("%Y-%m-%d") %}
              <td style="min-width:110px;">
                <div style="display:flex;align-items:center;justify-content:space-between;">
                  <a href="/page/calendar/month?year={{ year }}&month={{ month }}&ymd={{ ds }}"><b>{{ d.day }}</b></a>
                  {% if counts.get(ds) %}
                    <span class="badge">메모 {{ counts.get(ds) }}</span>
                  {% endif %}
                </div>
                {% if ds == selected %}
                  <div style="margin-top:6px;"><span style="background:#2563eb;color:#fff;border-radius:999px;padding:3px 8px;font-size:12px;">오늘</span></div>
                {% else %}
                  <div style="height:18px"></div>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="hr"></div>

    <form class="form" method="post" action="/page/calendar/memo/add">
      <input type="hidden" name="year" value="{{ year }}">
      <input type="hidden" name="month" value="{{ month }}">
      <div class="row"><label>날짜</label><input name="ymd" value="{{ selected }}" required></div>
      <div class="row"><label>작성자</label><input name="author" placeholder="이름(선택)"></div>
      <div class="row"><label>메모</label><textarea name="memo" placeholder="메모 입력" required></textarea></div>
      <button class="btn wide" type="submit">메모 추가</button>
    </form>

    <div class="hr"></div>
    <div style="font-weight:800;margin-bottom:10px;">메모 목록 ({{ selected }})</div>
    {% if memos|length == 0 %}
      <div class="muted">메모가 없습니다.</div>
    {% endif %}
    <ul class="menu-list">
      {% for m in memos %}
        <li class="menu-item" style="display:block">
          <div style="display:flex;justify-content:space-between;gap:10px;">
            <div><b>{{ m.author or "익명" }}</b> <span class="badge">{{ m.created_at }}</span></div>
          </div>
          <div style="margin-top:8px;white-space:pre-wrap">{{ m.memo }}</div>
        </li>
      {% endfor %}
    </ul>

  </div>
</div>
{% endblock %}
