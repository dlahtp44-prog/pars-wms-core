<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>출발 로케이션 QR</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;margin:0;padding:16px;background:#f5f6f8;}
    h2{margin:8px 0 12px;font-size:20px;}
    #reader{width:100%;max-width:520px;margin:0 auto;border-radius:14px;overflow:hidden;background:#000;}
    .hint{max-width:520px;margin:12px auto 0;color:#6b7280;font-size:13px;line-height:1.5;}
    .back{max-width:520px;margin:12px auto 0;}
    a{color:#0a7cff;text-decoration:none;font-weight:700;}
  </style>
</head>
<body>
  <h2>출발 로케이션 QR 스캔</h2>
  <div id="reader"></div>
  <div class="hint">출발 로케이션 QR을 스캔하면 해당 로케이션 재고 목록으로 이동합니다.</div>
  <div class="back"><a href="/m">← 모바일 홈</a></div>

<script>
(function(){
  const readerId = "reader";
  const qr = new Html5Qrcode(readerId);

  function normalizeLocation(decodedText){
    let raw = (decodedText || "").trim();
    let location = raw;

    if (location.includes(":")) location = location.split(":").pop();
    if (location.includes("|")) location = location.split("|").pop();
    if (location.startsWith("http")) location = location.split("/").pop();

    return (location || "").trim();
  }

  qr.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    (decodedText) => {
      const location = normalizeLocation(decodedText);
      if (!location) {
        alert("로케이션 인식 실패");
        return;
      }
      qr.stop().catch(()=>{});
      // ✅ 출발 로케이션 스캔 → 재고 목록(선택 화면)으로
      window.location.href = "/m/qr/inventory?location=" + encodeURIComponent(location);
    },
    (err) => { /* ignore */ }
  ).catch((e)=>{
    alert("카메라 실행 실패: 브라우저 권한/HTTPS 여부를 확인하세요.");
    console.error(e);
  });
})();
</script>
</body>
</html>
