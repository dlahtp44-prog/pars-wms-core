{% extends "_layout.html" %}
{% block body %}
<h1 class="h1 center">이력조회</h1>
<a class="back" href="/">← 홈</a>

<div class="card">
  <div class="row">
    <a class="btn outline" href="/page/history.xlsx?limit={{limit}}&year={{year}}&month={{month}}&htype={{htype}}">엑셀 다운로드</a>
    <a class="btn" href="/page/history?limit={{limit}}">새로고침</a>
  </div>
</div>

<div class="card mt">

<div class="card mt">
  <form method="get" action="/page/history">
    <div class="grid">
      <label>연도 <input name="year" value="{{year}}" placeholder="예: 2026"/></label>
      <label>월 <input name="month" value="{{month}}" placeholder="예: 1"/></label>
      <label>구분 <input name="htype" value="{{htype}}" placeholder="inbound/outbound/move/rollback"/></label>
      <label>Limit <input name="limit" value="{{limit}}" placeholder="200"/></label>
    </div>
    <div class="row mt">
      <button class="btn" type="submit">조회</button>
      <a class="btn outline" href="/page/history.xlsx?limit={{limit}}&year={{year}}&month={{month}}&htype={{htype}}">엑셀 다운로드</a>
    </div>
  </form>
</div>


  <table class="table">
    <thead>
      <tr>
        <th>시간</th><th>구분</th><th>로케이션</th><th>출발</th><th>도착</th><th>품번</th><th>품명</th><th>LOT</th><th>규격</th><th>브랜드</th><th>수량</th><th>비고</th><th>롤백</th>
      </tr>
    </thead>
    <tbody>
      {% if rows|length == 0 %}
      <tr><td colspan="12" class="muted">이력 데이터가 없습니다.</td></tr>
      {% endif %}
      {% for r in rows %}
      <tr>
        <td>{{r.ts}}</td><td>{{r.type}}</td><td>{{r.location}}</td><td>{{r.from_location}}</td><td>{{r.to_location}}</td>
        <td>{{r.item_code}}</td><td>{{r.item_name}}</td><td>{{r.lot}}</td><td>{{r.spec}}</td><td>{{r.brand}}</td><td>{{r.qty}}</td><td>{{r.note}}</td>
        <td>
          {% if r.type in ["inbound","outbound","move"] %}
          <form method="post" action="/api/rollback/{{r.id}}">
            <input name="reason" placeholder="사유" style="width:120px"/>
            <button class="btn outline" type="submit">롤백</button>
          </form>
          {% else %}-{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
