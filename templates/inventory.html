{% extends "base.html" %}
{% block body %}
<h1>재고 조회</h1>

<div class="badge"><a href="/" style="text-decoration:none;color:var(--primary);font-weight:600;">← 홈</a></div>

<div class="card" style="padding:16px;">
  <div class="grid">
    <div class="form-row"><span>로케이션</span><input class="input" id="location" placeholder="필터"></div>
    <div class="form-row"><span>품번</span><input class="input" id="item_code" placeholder="필터"></div>
    <button class="btn" id="btn">조회</button>
    <a class="btn-outline" id="dl" href="/page/inventory.xlsx">엑셀 다운로드</a>
    <div class="badge"><a href="/" style="text-decoration:none;color:var(--primary);font-weight:600;">← 홈</a></div>
    <div id="table"></div>
  </div>
</div>
{% endblock %}
{% block script %}
<script>
function esc(s){return String(s??'').replace(/[&<>"]/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[c]));}
document.getElementById('btn').addEventListener('click', async ()=>{
  const loc = document.getElementById('location').value;
  const code = document.getElementById('item_code').value;
  const qs = new URLSearchParams();
  if(loc) qs.set('location', loc);
  if(code) qs.set('item_code', code);
  const dlqs = qs.toString();
  document.getElementById('dl').href = '/page/inventory.xlsx' + (dlqs ? ('?' + dlqs) : '');
  const r = await fetch('/api/inventory?' + qs.toString());
  const t = await r.json();
  const rows = t.rows || [];
  let html = '<div style="overflow:auto;"><table style="width:100%;border-collapse:collapse;">';
  html += '<thead><tr>';
  const cols = ['location','item_code','item_name','lot','spec','brand','qty'];
  const labels = ['로케이션','품번','품명','LOT','규격','브랜드','수량'];
  for(let i=0;i<cols.length;i++){ html += '<th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">'+labels[i]+'</th>'; }
  html += '</tr></thead><tbody>';
  if(rows.length===0){
    html += '<tr><td colspan="7" style="padding:12px;color:#667085;">조회 결과가 없습니다.</td></tr>';
  }else{
    for(const row of rows){
      html += '<tr>';
      for(const c of cols){ html += '<td style="padding:10px;border-bottom:1px solid #f0f2f5;">'+esc(row[c])+'</td>'; }
      html += '</tr>';
    }
  }
  html += '</tbody></table></div>';
  document.getElementById('table').innerHTML = html;
});
</script>
{% endblock %}
