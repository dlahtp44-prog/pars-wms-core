<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ë„ì°© ë¡œì¼€ì´ì…˜ QR ìŠ¤ìº”</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 16px; }
  button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    background: #0a7cff;
    color: #fff;
    font-weight: 600;
    margin-bottom: 12px;
  }
  #reader {
    width: 300px;
    height: 300px;
    margin: 0 auto;
  }
</style>
</head>

<body>

<h3>ğŸ“ ë„ì°© ë¡œì¼€ì´ì…˜ QR ìŠ¤ìº”</h3>

<!-- âœ… ì‚¬ìš©ì ì œìŠ¤ì²˜ (í•„ìˆ˜) -->
<button id="startScan">ğŸ“· QR ìŠ¤ìº” ì‹œì‘</button>

<!-- âœ… ì¹´ë©”ë¼ ì˜ì—­ -->
<div id="reader"></div>

<!-- ğŸ”’ ì„œë²„ë¡œ ë„˜ê¸¸ ë°ì´í„° -->
<form id="moveForm" method="post" action="/m/qr/move/complete">
  <input type="hidden" name="from_location" value="{{ from_location }}">
  <input type="hidden" name="item_code" value="{{ item_code }}">
  <input type="hidden" name="item_name" value="{{ item_name }}">
  <input type="hidden" name="lot" value="{{ lot }}">
  <input type="hidden" name="spec" value="{{ spec }}">
  <input type="hidden" name="qty" value="{{ qty }}">
  <input type="hidden" name="to_location" id="to_location">
</form>

<script>
const qr = new Html5Qrcode("reader");

document.getElementById("startScan").addEventListener("click", () => {
  qr.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    (decodedText) => {
      qr.stop();

      let raw = decodedText.trim();
      let location = raw;

      if (location.includes(":")) location = location.split(":").pop();
      if (location.includes("|")) location = location.split("|").pop();
      if (location.startsWith("http")) location = location.split("/").pop();

      location = location.trim();

      if (!location) {
        alert("ë„ì°© ë¡œì¼€ì´ì…˜ QR ì¸ì‹ ì‹¤íŒ¨");
        return;
      }

      document.getElementById("to_location").value = location;
      document.getElementById("moveForm").submit();
    }
  ).catch(err => {
    alert("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨ â€“ ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.");
    console.error(err);
  });
});
</script>

</body>
</html>
