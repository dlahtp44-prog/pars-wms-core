{% extends "_layout.html" %}
{% block body %}
<link rel="stylesheet" href="/static/calendar.css">

<div class="card sheet-card">
  <div class="calendar-header" style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;">
    <div style="display:flex;gap:8px;align-items:center;">
      <a class="link" href="/page/calendar/month?year={{ prev_year }}&month={{ prev_month }}">◀</a>
      <div style="font-weight:800;font-size:20px;">{{ year }}년 {{ month }}월</div>
      <a class="link" href="/page/calendar/month?year={{ next_year }}&month={{ next_month }}">▶</a>
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
      <!-- 4) 오늘 기준 월로 즉시 이동 -->
      <a class="btn-outline" style="padding:8px 10px;" href="/page/calendar/month">오늘(월)</a>
      <!-- 2) 오늘 상세 바로가기 -->
      <a class="btn" style="padding:8px 10px;" href="/page/calendar?date={{ today_iso }}">오늘 상세</a>
    </div>
  </div>

  <div class="calendar-grid">
    <div class="dow">일</div><div class="dow">월</div><div class="dow">화</div>
    <div class="dow">수</div><div class="dow">목</div><div class="dow">금</div><div class="dow">토</div>

    {% for day in days %}
    <div id="d-{{ day.date_iso }}" class="cell {% if day.is_today %}today{% endif %} {% if day.is_weekend %}weekend{% endif %}">
      <div class="date">{{ day.date.day }}</div>

      {% for m in day.memos[:4] %}
        <div class="memo">· {{ m.memo }}</div>
      {% endfor %}

      {% if day.memos|length > 4 %}
        <div class="more">+{{ day.memos|length - 4 }}</div>
      {% endif %}

      <a class="cover" href="/page/calendar?date={{ day.date_iso }}" aria-label="open day"></a>
    </div>
    {% endfor %}
  </div>

  <div style="height:10px;"></div>
  <div class="small" style="color:#6b7280;">※ 날짜 칸 클릭 → 해당 날짜 상세(등록/수정). 메모는 기본 4줄 표시</div>
</div>

<script>
(function(){
  // 4) 오늘 자동 포커스 (현재 표시 월에 오늘이 포함될 때만)
  const y = {{ year }};
  const m = {{ month }};
  const ty = {{ today_year }};
  const tm = {{ today_month }};
  if (y === ty && m === tm) {
    const el = document.getElementById("d-{{ today_iso }}");
    if (el && el.scrollIntoView) {
      el.scrollIntoView({block: "center"});
    }
  }
})();
</script>
{% endblock %}
