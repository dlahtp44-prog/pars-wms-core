{% extends "base.html" %}
{% block body %}
<h1>이력조회</h1>

<div class="badge"><a href="/" style="text-decoration:none;color:var(--primary);font-weight:600;">← 홈</a></div>

<div class="card" style="padding:16px;">
  <div class="grid">
    <button class="btn" id="btn">새로고침</button>
    <div id="table"></div>
  </div>
</div>
{% endblock %}
{% block script %}
<script>
function esc(s){return String(s??'').replace(/[&<>"]/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[c]));}
async function load(){
  const r = await fetch('/api/history?limit=200');
  const t = await r.json();
  const rows = t.rows || [];
  let html = '<div style="overflow:auto;"><table style="width:100%;border-collapse:collapse;">';
  const cols = ['ts','kind','location','src_location','item_code','item_name','lot','spec','brand','qty','note'];
  const labels = ['시간','구분','로케이션','출발','품번','품명','LOT','규격','브랜드','수량','비고'];
  html += '<thead><tr>';
  for(let i=0;i<cols.length;i++){ html += '<th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">'+labels[i]+'</th>'; }
  html += '</tr></thead><tbody>';
  if(rows.length===0){
    html += '<tr><td colspan="'+cols.length+'" style="padding:12px;color:#667085;">이력 데이터가 없습니다.</td></tr>';
  }else{
    for(const row of rows){
      html += '<tr>';
      for(const c of cols){ html += '<td style="padding:10px;border-bottom:1px solid #f0f2f5;white-space:nowrap;">'+esc(row[c])+'</td>'; }
      html += '</tr>';
    }
  }
  html += '</tbody></table></div>';
  document.getElementById('table').innerHTML = html;
}
document.getElementById('btn').addEventListener('click', load);
load();
</script>
{% endblock %}
