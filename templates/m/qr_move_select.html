<!DOCTYPE html>
<html lang="ko">
<head>
  <title>QR ì´ë™ - ìƒí’ˆ ì„ íƒ</title>
  {% include "m/_qr_common_head.html" %}
  <style>
    .item{border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-top:10px;background:#fff;}
    .item .top{display:flex;gap:10px;align-items:flex-start;}
    .item label{font-weight:700;}
    .kv{font-size:13px;color:#111;line-height:1.4;margin-top:6px;}
    .kv b{color:#6b7280;font-weight:600;}
    .qty{max-width:150px;}
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸšš QR ì´ë™ (2/2) - ìƒí’ˆ ì„ íƒ</h2>
    <div class="muted">ì¶œë°œ: <b>{{ from_location }}</b></div>
  </div>

  <div class="card">
    {% if rows %}
    <form method="GET" action="/m/qr/move/to">
      <input type="hidden" name="from_location" value="{{ from_location }}" />
      {% for r in rows %}
        <div class="item">
          <div class="top">
            <input type="radio" name="pick" value="{{ loop.index0 }}" required style="width:20px;height:20px;margin-top:4px;" />
            <div style="flex:1;">
              <label>{{ r.item_code }} Â· {{ r.item_name }}</label>
              <div class="kv"><b>LOT</b> {{ r.lot }} | <b>ê·œê²©</b> {{ r.spec }} | <b>ìˆ˜ëŸ‰</b> {{ r.qty }}</div>
            </div>
          </div>
        </div>
      {% endfor %}

      <div class="row">
        <input class="qty" type="number" name="qty" value="1" min="1" required />
        <button type="button" class="secondary" onclick="fillSelected()">ì„ íƒ ì ìš©</button>
      </div>

      <!-- ì„ íƒëœ ìƒí’ˆ ì •ë³´(ìë™ ì„¸íŒ…) -->
      <input type="hidden" name="item_code" id="item_code" />
      <input type="hidden" name="item_name" id="item_name" />
      <input type="hidden" name="lot" id="lot" />
      <input type="hidden" name="spec" id="spec" />

      <button type="submit" onclick="return fillSelected(true)">ë„ì°© ë¡œì¼€ì´ì…˜ ìŠ¤ìº”ìœ¼ë¡œ</button>
    </form>
    {% else %}
      <div class="muted">í•´ë‹¹ ë¡œì¼€ì´ì…˜ì— ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    {% endif %}
  </div>

  <div class="card">
    <button class="secondary" onclick="history.back()">â† ë’¤ë¡œ</button>
  </div>

  <script>
    // Jinja rowsë¥¼ JS ë°°ì—´ë¡œ ë³€í™˜
    const rows = [
      {% for r in rows %}
      {item_code: "{{ r.item_code|e }}", item_name: "{{ r.item_name|e }}", lot: "{{ r.lot|e }}", spec: "{{ r.spec|e }}"},
      {% endfor %}
    ];

    function fillSelected(noAlert){
      const radios = document.querySelectorAll('input[name="pick"]');
      let idx = -1;
      radios.forEach((r,i)=>{ if(r.checked) idx = parseInt(r.value,10); });
      if(idx < 0){ if(!noAlert) alert('ì´ë™í•  ìƒí’ˆì„ ì„ íƒí•´ ì£¼ì„¸ìš”.'); return false; }
      const picked = rows[idx];
      document.getElementById('item_code').value = picked.item_code;
      document.getElementById('item_name').value = picked.item_name;
      document.getElementById('lot').value = picked.lot;
      document.getElementById('spec').value = picked.spec;
      return true;
    }
  </script>
</body>
</html>